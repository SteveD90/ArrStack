version: "3.8"

services:
  bazarr:
    image: ${BAZARR_IMAGE:-lscr.io/linuxserver/bazarr:latest}
    container_name: bazarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${BAZARR_CONFIG}:/config
      - ${MEDIA_PATH}:/media
      - ${BAZARR_DOWNLOADS}:/downloads
    ports:
      - "${BAZARR_PORT}:6767"
    restart: unless-stopped
    networks:
      - media-net
  radarr:
    image: ${RADARR_IMAGE:-lscr.io/linuxserver/radarr:latest}
    container_name: radarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${RADARR_CONFIG}:/config
      - ${MEDIA_PATH}:/media
      - ${RADARR_DOWNLOADS}:/downloads
    ports:
      - "${RADARR_PORT}:7878"
    restart: unless-stopped
    networks:
      - media-net

  prowlarr:
    image: ${PROWLARR_IMAGE:-lscr.io/linuxserver/prowlarr:latest}
    container_name: prowlarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${PROWLARR_CONFIG}:/config
      - ${MEDIA_PATH}:/media
    ports:
      - "${PROWLARR_PORT}:9696"
    restart: unless-stopped
    networks:
      - media-net

  sonarr:
    image: ${SONARR_IMAGE:-lscr.io/linuxserver/sonarr:latest}
    container_name: sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${SONARR_CONFIG}:/config
      - ${MEDIA_PATH}:/media
      - ${SONARR_DOWNLOADS}:/downloads
    ports:
      - "${SONARR_PORT}:8989"
    restart: unless-stopped
    networks:
      - media-net

  profilarr:
    image: ${PROFILARR_IMAGE:-santiagosayshey/profilarr:latest}
    container_name: profilarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${PROFILARR_CONFIG}:/config
    ports:
      - "${PROFILARR_PORT}:6868"
    restart: unless-stopped
    networks:
      - media-net

  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:latest
    container_name: sabnzbd
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${SABNZBD_CONFIG}:/config
      - ${SABNZBD_DOWNLOADS}:/downloads
    ports:
      - "${SABNZBD_PORT}:8080"
      - "9090:9090"
    restart: unless-stopped
    networks:
      - media-net

  sab-stream-proxy:
    image: yourrepo/sab-stream-proxy:latest   # or build: ./sab-stream-proxy if you include the folder
    container_name: sab-stream-proxy
    environment:
      - SAB_HOST=http://sabnzbd:8080          # service name must match your SAB service name
      - SAB_APIKEY=${SAB_APIKEY}
      - DOWNLOADS_DIR=/downloads              # must match the path inside container where SAB writes
      - BASE_URL=${BASE_URL}                  # e.g., https://usenet.sdonn14.org or http://<host-ip>
      - PORT=3000
    volumes:
      - ${SAB_STREAM_PROXY_CONFIG}:/usr/src/app       # optional if building locally
      - ${SABNZBD_DOWNLOADS}:/downloads:rw        # KEEP this the same host path/volume that SAB uses
    ports:
      - "${SAB_STREAM_PROXY_PORT}:3000"
    depends_on:
      - sabnzbd
    restart: unless-stopped
    networks:
      - media-net

networks:
  media-net:
    driver: bridge